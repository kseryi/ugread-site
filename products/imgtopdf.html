<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>IMG → PDF</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f2f2f2;
    max-width: 800px;
    margin: auto;
    padding: 20px;
}

h1 {
    text-align: center;
}

input, button {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
}

button {
    background: #2d89ef;
    color: white;
    border: none;
    cursor: pointer;
}

button:hover {
    background: #1b5fa7;
}

#preview {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 10px;
    margin-top: 20px;
}

.thumb {
    background: white;
    border: 1px solid #ccc;
    padding: 5px;
    cursor: grab;
}

.thumb img {
    width: 100%;
    height: 120px;
    object-fit: cover;
}

.thumb span {
    display: block;
    text-align: center;
    font-size: 12px;
    margin-top: 5px;
    color: #555;
}
</style>
</head>

<body>

<h1>IMG → PDF</h1>

<input type="file" id="imageInput" accept="image/*" multiple>
<button onclick="createPDF()">Створити PDF</button>

<div id="preview"></div>

<script>
const imageInput = document.getElementById("imageInput");
const preview = document.getElementById("preview");
let images = [];

imageInput.addEventListener("change", handleImages);

function handleImages() {
    images = [];
    preview.innerHTML = "";

    [...imageInput.files].forEach((file, index) => {
        const reader = new FileReader();
        reader.onload = () => {
            images.push({
                name: file.name,
                data: reader.result,
                type: file.type.includes("png") ? "PNG" : "JPEG"
            });

            const div = document.createElement("div");
            div.className = "thumb";
            div.dataset.index = index;

            div.innerHTML = `
                <img src="${reader.result}">
                <span>${file.name}</span>
            `;

            preview.appendChild(div);
        };
        reader.readAsDataURL(file);
    });
}

/* Drag & Drop */
new Sortable(preview, {
    animation: 150,
    onEnd: () => {
        const newOrder = [];
        preview.querySelectorAll(".thumb").forEach((el) => {
            newOrder.push(images[el.dataset.index]);
        });
        images = newOrder;

        preview.querySelectorAll(".thumb").forEach((el, i) => {
            el.dataset.index = i;
        });
    }
});

async function createPDF() {
    if (images.length === 0) {
        alert("Додайте зображення");
        return;
    }

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF("p", "mm", "a4");

    for (let i = 0; i < images.length; i++) {
        if (i > 0) pdf.addPage();

        const img = await loadImg(images[i].data);

        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();

        const ratio = Math.min(
            pageWidth / img.width,
            pageHeight / img.height
        );

        const w = img.width * ratio;
        const h = img.height * ratio;

        const x = (pageWidth - w) / 2;
        const y = (pageHeight - h) / 2;

        pdf.addImage(images[i].data, images[i].type, x, y, w, h);
    }

    pdf.save("images.pdf");
}

function loadImg(src) {
    return new Promise(resolve => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.src = src;
    });
}
</script>

</body>
</html>
